<!-- templates/authentication/profile_setup.html -->
{% extends 'base/base.html' %}

{% block title %}Configurar Perfil - NutriMatch{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center py-5">
        <div class="col-md-8">
            <div class="card">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <i class="fas fa-user-cog text-success" style="font-size: 3rem;"></i>
                        <h2 class="card-title mt-2">Configura tu Perfil</h2>
                        <p class="text-muted">
                            Necesitamos algunos datos para personalizar tus recomendaciones
                        </p>
                    </div>
                    
                    <form method="post">
                        {% csrf_token %}
                        
                        <!-- Información Personal -->
                        <div class="row">
                            <div class="col-12 mb-4">
                                <h5><i class="fas fa-user"></i> Información Personal</h5>
                                <hr>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="age" class="form-label">Edad</label>
                                <input type="number" class="form-control" id="age" name="age" min="10" max="120" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="weight" class="form-label">Peso (kg)</label>
                                <input type="number" class="form-control" id="weight" name="weight" step="0.1" min="20" max="300" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="height" class="form-label">Altura (cm)</label>
                                <input type="number" class="form-control" id="height" name="height" min="100" max="250" required>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="gender" class="form-label">Género</label>
                            <select class="form-select" id="gender" name="gender" required>
                                <option value="">Selecciona tu género</option>
                                {% for value, display in genders %}
                                    <option value="{{ value }}">{{ display }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <!-- Objetivos -->
                        <div class="row">
                            <div class="col-12 mb-4">
                                <h5><i class="fas fa-target"></i> Objetivos</h5>
                                <hr>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="goal" class="form-label">¿Cuál es tu objetivo principal?</label>
                                <select class="form-select" id="goal" name="goal" required>
                                    <option value="">Selecciona tu objetivo</option>
                                    {% for value, display in goals %}
                                        <option value="{{ value }}">{{ display }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="activity_level" class="form-label">Nivel de Actividad Física</label>
                                <select class="form-select" id="activity_level" name="activity_level" required>
                                    <option value="">Selecciona tu nivel</option>
                                    <option value="sedentary">Sedentario (trabajo de oficina, poco ejercicio)</option>
                                    <option value="light">Actividad ligera (ejercicio 1-3 días/semana)</option>
                                    <option value="moderate">Actividad moderada (ejercicio 3-5 días/semana)</option>
                                    <option value="active">Muy activo (ejercicio 6-7 días/semana)</option>
                                    <option value="extra_active">Extremadamente activo (ejercicio 2 veces/día)</option>
                                </select>
                            </div>
                        </div>
                        
                        <!-- Preferencias Dietéticas -->
                        <div class="row">
                            <div class="col-12 mb-4">
                                <h5><i class="fas fa-utensils"></i> Preferencias Dietéticas</h5>
                                <hr>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">Restricciones o preferencias dietéticas (opcional)</label>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="vegetarian" name="dietary_preferences" value="vegetarian">
                                        <label class="form-check-label" for="vegetarian">
                                            <i class="fas fa-leaf text-success"></i> Vegetariano
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="vegan" name="dietary_preferences" value="vegan">
                                        <label class="form-check-label" for="vegan">
                                            <i class="fas fa-seedling text-success"></i> Vegano
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="gluten_free" name="dietary_preferences" value="gluten_free">
                                        <label class="form-check-label" for="gluten_free">
                                            <i class="fas fa-ban text-warning"></i> Sin Gluten
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="dairy_free" name="dietary_preferences" value="dairy_free">
                                        <label class="form-check-label" for="dairy_free">
                                            <i class="fas fa-ban text-info"></i> Sin Lácteos
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="keto" name="dietary_preferences" value="keto">
                                        <label class="form-check-label" for="keto">
                                            <i class="fas fa-fire text-danger"></i> Keto
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Preferencias Adicionales -->
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="meal_count" class="form-label">Comidas por día</label>
                                <select class="form-select" id="meal_count" name="meal_count">
                                    <option value="3">3 comidas principales</option>
                                    <option value="4">3 comidas + 1 snack</option>
                                    <option value="5">3 comidas + 2 snacks</option>
                                    <option value="6">6 comidas pequeñas</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="budget_preference" class="form-label">Presupuesto de Alimentación</label>
                                <select class="form-select" id="budget_preference" name="budget_preference">
                                    <option value="low">Económico</option>
                                    <option value="medium" selected>Moderado</option>
                                    <option value="high">Sin restricción</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="d-grid mt-4">
                           <button type="submit" class="btn btn-primary btn-lg">
                               <i class="fas fa-check"></i> Completar Configuración
                           </button>
                       </div>
                   </form>
               </div>
           </div>
       </div>
   </div>
</div>

<script>
// Calcular y mostrar BMR en tiempo real
document.addEventListener('DOMContentLoaded', function() {
   const ageInput = document.getElementById('age');
   const weightInput = document.getElementById('weight');
   const heightInput = document.getElementById('height');
   const genderSelect = document.getElementById('gender');
   
   function calculateBMR() {
       const age = parseInt(ageInput.value);
       const weight = parseFloat(weightInput.value);
       const height = parseFloat(heightInput.value);
       const gender = genderSelect.value;
       
       if (age && weight && height && gender) {
           let bmr;
           if (gender === 'M') {
               bmr = 88.362 + (13.397 * weight) + (4.799 * height) - (5.677 * age);
           } else if (gender === 'F') {
               bmr = 447.593 + (9.247 * weight) + (3.098 * height) - (4.330 * age);
           }
           
           if (bmr) {
               // Mostrar BMR calculado (opcional)
               console.log('BMR calculado:', Math.round(bmr));
           }
       }
   }
   
   [ageInput, weightInput, heightInput, genderSelect].forEach(input => {
       input.addEventListener('change', calculateBMR);
   });
});
</script>
{% endblock %}